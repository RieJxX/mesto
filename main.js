(()=>{"use strict";var e,t={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"4b22178e-75b6-4577-8449-3721cabf06f2","Content-Type":"application/json"}},n=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},o=document.querySelector("#card-template").content,r=document.querySelector(".places__list");function c(r){var c=o.querySelector(".card").cloneNode(!0),i=c.querySelector(".card__image"),l=c.querySelector(".card__title"),u=c.querySelector(".card__delete-button"),d=c.querySelector(".card__like-button"),s=c.querySelector(".card__like-count");return i.src=r.link,i.alt=r.name,l.textContent=r.name,s.textContent=r.likes.length,r.likes.some((function(t){return t._id===e}))&&d.classList.add("card__like-button_is-active"),d.addEventListener("click",(function(){var e;d.classList.contains("card__like-button_is-active")?(e=r._id,fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return e.json()}))).then((function(e){d.classList.remove("card__like-button_is-active"),s.textContent=e.likes.length})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then((function(e){return e.json()}))}(r._id).then((function(e){d.classList.add("card__like-button_is-active"),s.textContent=e.likes.length})).catch((function(e){return console.log(e)}))})),r.owner._id===e?(u.style.display="block",u.addEventListener("click",(function(){var e;(e=r._id,fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers}).then(n)).then((function(){c.remove()})).catch((function(e){return console.log(e)}))}))):u.style.display="none",i.addEventListener("click",(function(){var e,t;e=r.name,t=r.link,S.src=t,S.alt=e,q.textContent=e,a(m)})),c}function a(e){e.classList.add("popup_is-opened")}function i(e){e.classList.remove("popup_is-opened")}fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then(n).then((function(t){e=t._id,document.querySelector(".profile__title").textContent=t.name,document.querySelector(".profile__description").textContent=t.about,document.querySelector(".profile__image").style.backgroundImage="url(".concat(t.avatar,")")})).catch((function(e){return console.log(e)})),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then(n).then((function(e){e.forEach((function(e){r.append(c(e))}))})).catch((function(e){return console.log(e)}));var l=document.querySelector(".popup_type_edit"),u=document.querySelector(".profile__title"),d=document.querySelector(".profile__description"),s=document.querySelector(".popup__input_type_name"),p=document.querySelector(".popup__input_type_description"),_=document.querySelector('form[name="edit-profile"]');document.querySelector(".profile__edit-button").addEventListener("click",(function(){s.value=u.textContent,p.value=d.textContent,a(l)})),l.querySelector(".popup__close").addEventListener("click",(function(){i(l)})),_.addEventListener("submit",(function(e){e.preventDefault();var o,r,c=_.querySelector(".popup__button");c.textContent="Сохранение...",(o=s.value,r=p.value,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:o,about:r})}).then(n)).then((function(){u.textContent=s.value,d.textContent=p.value,i(l)})).catch((function(e){return console.log(e)})).finally((function(){c.textContent="Сохранить"}))}));var y=document.querySelector(".popup_type_new-card"),f=document.querySelector('form[name="new-place"]'),v=f.querySelector(".popup__input_type_card-name"),h=f.querySelector(".popup__input_type_url");document.querySelector(".profile__add-button").addEventListener("click",(function(){f.reset(),a(y)})),y.querySelector(".popup__close").addEventListener("click",(function(){i(y)})),f.addEventListener("submit",(function(e){e.preventDefault();var o,a,l=f.querySelector(".popup__button");l.textContent="Сохранение...",(o=v.value,a=h.value,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:o,link:a})}).then(n)).then((function(e){var t=c(e);r.prepend(t),i(y)})).catch((function(e){return console.log(e)})).finally((function(){l.textContent="Сохранить"}))}));var m=document.querySelector(".popup_type_image"),S=m.querySelector(".popup__image"),q=m.querySelector(".popup__caption");m.querySelector(".popup__close").addEventListener("click",(function(){i(m)}));var b=_.querySelector(".popup__button");function k(){b.disabled=!_.checkValidity();var e=l.querySelector(".popup__error_type_name"),t=l.querySelector(".popup__error_type_description");s.validity.valid?e.style.display="none":(e.textContent=s.validationMessage,e.style.display="block"),p.validity.valid?t.style.display="none":(t.textContent=p.validationMessage,t.style.display="block")}[s,p].forEach((function(e){e.addEventListener("input",k)}));var g=f.querySelector(".popup__button");function E(){g.disabled=!f.checkValidity();var e=y.querySelector(".popup__error_type_place-name"),t=y.querySelector(".popup__error_type_link");console.log(e,t,y),v.validity.valid?e.style.display="none":(e.textContent=v.validationMessage,e.style.display="block"),h.validity.valid?t.style.display="none":(t.textContent=h.validationMessage,t.style.display="block")}[v,h].forEach((function(e){e.addEventListener("input",E)})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){t.target===e&&i(e)}))})),document.addEventListener("keydown",(function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&i(t)}}));var L=document.querySelector(".popup__form_avatar"),C=L.querySelector(".popup__input_type_avatar"),x=document.querySelector(".profile__image"),U=L.querySelector(".popup__button"),T=document.querySelector(".profile__edit-avatar-button"),w=document.querySelector(".popup_type_avatar"),j=w.querySelector(".popup__close");C.addEventListener("input",(function(){U.disabled=!L.checkValidity();var e=L.querySelector(".popup__error_type_avatar");C.validity.valid?e.style.display="none":(e.textContent=C.validationMessage,e.style.display="block")}));var D=function(){w.classList.remove("popup_is-opened"),document.body.style.overflow=""};T.addEventListener("click",(function(){w.classList.add("popup_is-opened"),document.body.style.overflow="hidden"})),j.addEventListener("click",D),L.addEventListener("submit",(function(e){e.preventDefault();var o=C.value;U.textContent="Сохранение...",function(e){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e})}).then(n)}(o).then((function(e){x.style.backgroundImage="url(".concat(e.avatar,")"),D()})).catch((function(e){console.error(e),alert("Произошла ошибка при смене аватара. Попробуйте снова.")})).finally((function(){U.textContent="Сохранить"}))})),document.querySelector(".logo").src="assets/logo.svg"})();