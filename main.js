(()=>{"use strict";var e,t={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"4b22178e-75b6-4577-8449-3721cabf06f2","Content-Type":"application/json"}},n=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},o=function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then((function(e){return e.json()}))},r=function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return e.json()}))},c=document.querySelector("#card-template").content,a=document.querySelector(".places__list"),u=document.querySelector(".popup_type_edit"),i=document.querySelector(".profile__title"),l=document.querySelector(".profile__description"),p=document.querySelector(".popup__input_type_name"),d=document.querySelector(".popup__input_type_description"),s=document.querySelector('form[name="edit-profile"]'),_=s.querySelector(".popup__button"),y=document.querySelector(".popup_type_new-card"),f=document.querySelector('form[name="new-place"]'),h=f.querySelector(".popup__input_type_card-name"),m=f.querySelector(".popup__input_type_url"),v=f.querySelector(".popup__button"),S=document.querySelector(".popup_type_image"),b=S.querySelector(".popup__image"),q=S.querySelector(".popup__caption"),k=document.querySelector(".popup_type_avatar"),E=document.querySelector(".popup__form_avatar"),L=E.querySelector(".popup__input_type_avatar"),C=document.querySelector(".profile__image"),g=E.querySelector(".popup__button"),x=document.querySelector(".profile__edit-avatar-button");function U(e){e.classList.add("popup_is-opened"),document.body.style.overflow="hidden"}function T(e){e.classList.remove("popup_is-opened"),document.body.style.overflow=""}function w(e,t){e.reset(),function(e){e.querySelectorAll(".popup__error").forEach((function(e){return e.style.display="none"}))}(t)}function j(a){var u=c.querySelector(".card").cloneNode(!0),i=u.querySelector(".card__image"),l=u.querySelector(".card__title"),p=u.querySelector(".card__delete-button"),d=u.querySelector(".card__like-button"),s=u.querySelector(".card__like-count");return i.src=a.link,i.alt=a.name,l.textContent=a.name,s.textContent=a.likes.length,a.likes.some((function(t){return t._id===e}))&&d.classList.add("card__like-button_is-active"),d.addEventListener("click",(function(){return function(e,t,n){(t.classList.contains("card__like-button_is-active")?r:o)(e._id).then((function(e){t.classList.toggle("card__like-button_is-active"),n.textContent=e.likes.length})).catch(console.error)}(a,d,s)})),a.owner._id===e?(p.style.display="block",p.addEventListener("click",(function(){return function(e,o){var r;(r=e._id,fetch("".concat(t.baseUrl,"/cards/").concat(r),{method:"DELETE",headers:t.headers}).then(n)).then((function(){return o.remove()})).catch(console.error)}(a,u)}))):p.style.display="none",i.addEventListener("click",(function(){return e=a.name,t=a.link,b.src=t,b.alt=e,q.textContent=e,void U(S);var e,t})),u}function A(){_.disabled=!s.checkValidity(),N(p,".popup__error_type_name",u),N(d,".popup__error_type_description",u)}function D(){v.disabled=!f.checkValidity(),N(h,".popup__error_type_place-name",y),N(m,".popup__error_type_link",y)}function P(){g.disabled=!E.checkValidity(),N(L,".popup__error_type_avatar",k)}function N(e,t,n){var o=n.querySelector(t);""===e.value||e.validity.valid?o.style.display="none":(o.textContent=e.validationMessage,o.style.display="block")}s.addEventListener("submit",(function(e){var o,r;e.preventDefault(),_.textContent="Сохранение...",(o=p.value,r=d.value,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:o,about:r})}).then(n)).then((function(){i.textContent=p.value,l.textContent=d.value,T(u)})).catch(console.error).finally((function(){_.textContent="Сохранить"}))})),[p,d].forEach((function(e){return e.addEventListener("input",A)})),f.addEventListener("submit",(function(e){var o,r;e.preventDefault(),v.textContent="Сохранение...",(o=h.value,r=m.value,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:o,link:r})}).then(n)).then((function(e){a.prepend(j(e)),T(y)})).catch((function(){var e=f.querySelector(".popup__error_type_link");e.style.display="block",e.textContent="Картинка имеет неверный URL"})).finally((function(){v.textContent="Сохранить"}))})),[h,m].forEach((function(e){return e.addEventListener("input",D)})),E.addEventListener("submit",(function(e){var o;e.preventDefault(),g.textContent="Сохранение...",(o=L.value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:o})}).then(n)).then((function(e){C.style.backgroundImage="url(".concat(e.avatar,")"),T(k)})).catch((function(e){var t=E.querySelector(".popup__error_type_avatar");t.style.display="block",t.textContent="Картинка имеет неверный URL"})).finally((function(){g.textContent="Сохранить"}))})),L.addEventListener("input",P),document.querySelector(".profile__edit-button").addEventListener("click",(function(){p.value=i.textContent,d.value=l.textContent,A(),U(u)})),document.querySelector(".profile__add-button").addEventListener("click",(function(){w(f,y),D(),U(y)})),x.addEventListener("click",(function(){w(E,k),P(),U(k)})),document.querySelectorAll(".popup__close").forEach((function(e){return e.addEventListener("click",(function(e){return T(e.target.closest(".popup"))}))})),document.addEventListener("keydown",(function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&T(t)}})),document.querySelectorAll(".popup").forEach((function(e){return e.addEventListener("click",(function(t){t.target===e&&T(e)}))})),fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then(n).then((function(t){e=t._id,i.textContent=t.name,l.textContent=t.about,C.style.backgroundImage="url(".concat(t.avatar,")")})).catch(console.error),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then(n).then((function(e){e.forEach((function(e){return a.append(j(e))}))})).catch(console.error),document.querySelector(".logo").src="assets/logo.svg"})();